display_name: '&aPrison Intro Quest'

completion:
  max_completions: 999

description: 
  - Bring players through an interactive tutorial where they learn to
  - mine resources, upgrade their pickaxe, and climb levels with progress boosters.

status_items:
  AVAILABLE:
    type: EMERALD
    name: '&aPrison Intro - Available'
    lore: 
      - '&aObjective: &7An introduction to the Prison!.'
      - '&7>'
      - '&e&lEstimated Time:'
      - '&710 Minutes'
  PROGRESS:
    type: SUNFLOWER
    name: '&aPrison Intro - In Progress'
    lore: 
      - '&aObjective: &7An introduction to the Prison!.'
      - '&7>'
      - '&e&lEstimated Time:'
      - '&710 Minutes'
    enchantments:
      damage_all: 1
    flags: HIDE_ENCHANTS
  UNAVAILABLE:
    type: BARRIER
    name: '&cPrison Intro - Unavailable'
    lore: 
      - '&aObjective: &7An introduction to the Prison!.'
      - '&7>'
      - '&e&lEstimated Time:'
      - '&710 Minutes'
  COMPLETED:
    type: LIME_STAINED_GLASS_PANE
    name: '&aPrison Intro - Completed'
    lore: 
      - '&aObjective: &7An introduction to the Prison!.'
      - '&7>'
      - '&e&lEstimated Time:'
      - '&710 Minutes'

branches:

  main:
    starts_at: saveatoms #dialogue_1
    starts_directly: true
    objects:

      saveatoms:
        type: SERVER_LOGIC_VARIABLE
        goto: OBJECT saveprogress
        variable: CurrentAtoms
        value_formula: '%xprison_atoms_raw%'

      saveprogress:
        type: SERVER_LOGIC_VARIABLE
        goto: OBJECT savelevel
        variable: CurrentProgress
        value_formula: '%vault_eco_balance_fixed%'

      savelevel:
        type: SERVER_LOGIC_VARIABLE
        goto: OBJECT savemultipliervalue
        variable: CurrentLevel
        value_formula: '%xprison_level%'

      savemultipliervalue:
        type: SERVER_LOGIC_VARIABLE
        goto: OBJECT savemultiplierminutes
        variable: CurrentMultiplier
        value_formula: '%multiplier_progress_amount%'

      savemultiplierminutes:
        type: SERVER_LOGIC_VARIABLE
        goto: OBJECT savetokens
        variable: CurrentMultiplierMinutes
        value_formula: '%multiplier_progress_duration%'

      savetokens:
        type: SERVER_LOGIC_VARIABLE
        goto: OBJECT 00_start_tutorialtp
        variable: CurrentTokens
        value_formula: '%tm_tokens%'

      00_start_tutorialtp:
        hide_chat: true
        type: SERVER_ACTIONS
        actions: 
          - PERFORM_COMMAND lp user %player_name% parent add prisonintro
          - PERFORM_COMMAND lp user %player_name% parent remove default
          - PERFORM_COMMAND lp user %player_name% permission set progress.interactive.rewards false
          - PERFORM_COMMAND saveinventory %player_name%
          - 'PERFORM_COMMAND warp prisonintro %player_name%'
          - PERFORM_COMMAND lp user %player_name% permission set progress.milestones false
          - WAIT_TICKS 10
          - PERFORM_COMMAND setchannel %player_name% tutorial
          - WAIT_TICKS 10
          - PERFORM_COMMAND clear %player_name% **
          - PERFORM_COMMAND asa setmultiplier %player_name% 0 1
          - PERFORM_COMMAND tm set %player_name% 0
          - PERFORM_COMMAND atoms set %player_name% 0
          - PERFORM_COMMAND eco reset %player_name%
          - PERFORM_COMMAND level set %player_name% 0
          - WAIT_TICKS 20
          - 'PERFORM_COMMAND qc gpson %player_name%'
          - 'PERFORM_COMMAND kit give prisonintropick %player_name%'
          - SEND_MESSAGE &0
          - 'SEND_MESSAGE &a&lInteractive Prison Intro Quest Starting...'
          - SEND_MESSAGE &0
          - WAIT_TICKS 60
          - SEND_SOUND BLOCK_NOTE_BLOCK_PLING
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - 'SEND_MESSAGE &a> &7Chat is disabled while in the Quest.'
          - SEND_MESSAGE &0
          - WAIT_TICKS 60
          - 'SEND_MESSAGE &a> &7Failure to proceed in the quest will cancel the quest.'
          - SEND_MESSAGE &0
          - WAIT_TICKS 60
          - 'SEND_MESSAGE &a> &7You must complete it all the way through or your progress will not be saved.'
          - SEND_MESSAGE &0
          - WAIT_TICKS 60
          - 'SEND_MESSAGE &a> &7&oIf you become stuck at any point, type &c&oendtutorial&7.'
          - SEND_MESSAGE &0
          - WAIT_TICKS 100
          - SEND_SOUND BLOCK_NOTE_BLOCK_PLING
          - 'SEND_MESSAGE &8[&e&lIntro&8] &aConfirm start of Prison Intro Quest?'
          - 'SEND_MESSAGE &7&o (Select an option in chat)'
          - SEND_MESSAGE &0
        goto: OBJECT 00_start_diverge
        time_limit:
          duration: 3 minute
          fail_goto: BRANCH branch_timed_out

      00_start_diverge:
        type: DIVERGE_CHAT
        hide_chat: true
        choices:
          no:
            text: '&c&lNO'
            goto: OBJECT select_end_quest
          yes:
            text: '&a&lYES'
            goto: OBJECT start
        repeat_delay: 15 SECOND
        time_limit:
          duration: 3 minute
          fail_goto: BRANCH branch_timed_out

      start:
        type: SERVER_ACTIONS
        hide_chat: true
        goto: OBJECT dialogue_1
        #      progress_conditions:
        #        conditions:
        #          a:
        #            type: POSITION
        #            position:
        #              type: WORLDGUARD_REGION_INSIDE
        #              world: NewSpawnWorld
        #              region: intro
        actions: 
          - SEND_SOUND BLOCK_PORTAL_TRAVEL
          - SEND_MESSAGE &0
          - 'SEND_MESSAGE &c&l&oTO THE MINES, PRISONER!'
          - SEND_MESSAGE &0

      dialogue_1:
        type: SERVER_ACTIONS
        hide_chat: true
        goto: OBJECT mineorientation
        # this is the perm that allows the player down into the pit to kill 50 zombies
        actions: 
          - SEND_SOUND BLOCK_NOTE_BLOCK_PLING
          - SEND_MESSAGE &0
          - SEND_MESSAGE &e&lPRISON INTRO INCOMING
          - SEND_MESSAGE &0
          - WAIT_TICKS 80
          - SEND_SOUND ENTITY_VILLAGER_HURT
          - 'SEND_MESSAGE &8[&e&lNPC&8] &aSnorky &e» &7So &b%player_name%,&7 you''ve made it to the mines...'
          - SEND_MESSAGE &0
          - WAIT_TICKS 80
          - SEND_SOUND ENTITY_VILLAGER_HURT
          - 'SEND_MESSAGE &8[&e&lNPC&8] &aSnorky &e» &7I hope you''re ready to work!'
          - SEND_MESSAGE &0
          - WAIT_TICKS 80
          - SEND_SOUND ENTITY_VILLAGER_HURT
          - 'SEND_MESSAGE &8[&e&lNPC&8] &aSnorky &e» &7To begin, equip your pickaxe and begin mining blocks in the mine.'
          - SEND_MESSAGE &0
          - WAIT_TICKS 80
          - SEND_SOUND ENTITY_VILLAGER_HURT
          - 'SEND_MESSAGE &8[&e&lNPC&8] &aSnorky &e» &7I''ll call you back here when you reach &aLevel 1&7.'
          - SEND_MESSAGE &0
          - WAIT_TICKS 80
          - SEND_SOUND ITEM_TOTEM_USE
          - SEND_MESSAGE &a&lFIRST OBJECTIVE
          - SEND_MESSAGE &bReach Level 1
          - SEND_SOUND BLOCK_NOTE_BLOCK_PLING
          - 'SEND_TITLE 20 40 20 &a&lFIRST OBJECTIVE,&bReach Level 1'
          - SEND_PARTICLES FIREWORKS_SPARK 3 true
          - SEND_MESSAGE &0
          - PERFORM_COMMAND lp user %player_name% permission set jetsprisonmines.blockbreak.lvl.1 true 

      mineorientation:
        type: SERVER_ACTIONS
        hide_chat: true
        goto: OBJECT entermine
        # this is the perm that allows the player down into the pit to kill 50 zombies
        actions: 
          - WAIT_TICKS 60
          - SEND_SOUND BLOCK_NOTE_BLOCK_PLING
          - SEND_MESSAGE &0
          - SEND_MESSAGE &7&lMake your way into the mine and reach &a&lLevel 1&7&l by mining blocks!
          - SEND_MESSAGE &0
          - WAIT_TICKS 80
        gps:
          enabled: true
          mode: GPS
          custom_point: lvl1mine

      entermine:
        type: NONE
        hide_chat: true
        goto: OBJECT level_up_to_one
        progress_conditions:
          conditions:
            a:
              type: POSITION
              position:
                type: WORLDGUARD_REGION_INSIDE
                world: MineWorldv2
                region: lvl1mine
        gps:
          enabled: true
          mode: GPS
          custom_point: lvl1mine
        time_limit:
          duration: 1 minute
          fail_goto: OBJECT level_up_to_one

      level_up_to_one:
        type: NONE
        progress_conditions:
          conditions:
            a:
              type: LOGIC
              logic: '%xprison_level% >= 1'
        goto: OBJECT leveled_up
        update_notify:
          message: '&b&l&oMine in the mine to reach Level 1...'
        update_notify_delay: 10 SECOND  

      leveled_up:
        type: SERVER_ACTIONS
        hide_chat: true
        goto: OBJECT upgradepickaxe
        actions: 
          - SEND_SOUND UI_TOAST_IN
          - SEND_SOUND ENTITY_PLAYER_LEVELUP
          - 'SEND_TITLE 20 40 20 &a&lOBJETIVE COMPLETE,&fReach Level 1'
          - PERFORM_COMMAND lp user %player_name% permission set jetsprisonmines.blockbreak.lvl.1 false 
          - SEND_PARTICLES FIREWORKS_SPARK 3 true
          - SEND_SOUND ENTITY_VILLAGER_YES
          - SEND_MESSAGE &6&lOBJECTIVE COMPLETE
          - SEND_MESSAGE &bReach Level 1
          - SEND_MESSAGE &7
          - WAIT_TICKS 60
          - SEND_SOUND ENTITY_VILLAGER_HURT
          - 'SEND_MESSAGE &8[&e&lNPC&8] &aSnorky &e» &7Well done %player_name%, you''re getting the hang of it.'
          - SEND_MESSAGE &0
          - WAIT_TICKS 80
          - SEND_SOUND ENTITY_VILLAGER_HURT
          - 'SEND_MESSAGE &8[&e&lNPC&8] &aSnorky &e» &7Let''s try and speed this process up a bit&7!'
          - SEND_MESSAGE &0
          - WAIT_TICKS 80
          - SEND_SOUND ENTITY_VILLAGER_HURT
          - 'SEND_MESSAGE &8[&e&lNPC&8] &aSnorky &e» &7If you want to earn more progress faster, go ahead and upgrade your pickaxe with some stronger enchantments.'
          - SEND_MESSAGE &0
          - WAIT_TICKS 80
          - SEND_SOUND ENTITY_VILLAGER_HURT
          - 'SEND_MESSAGE &8[&e&lNPC&8] &aSnorky &e» &7To upgrade your pickaxe, hold it in your main hand and type &b/upgrade&7.'
          - SEND_MESSAGE &0
          - WAIT_TICKS 80
          - SEND_SOUND ENTITY_VILLAGER_HURT
          - 'SEND_MESSAGE &8[&e&lNPC&8] &aSnorky &e» &7From there, go ahead and click the &eFortune&7 enchantment to add a level.'
          - SEND_MESSAGE &0
          - WAIT_TICKS 80
          - SEND_SOUND ENTITY_VILLAGER_HURT
          - 'SEND_MESSAGE &8[&e&lNPC&8] &aSnorky &e» &7Once you do this, I''ll give you your next instructions.'
          - SEND_MESSAGE &0
          - WAIT_TICKS 80
          - SEND_SOUND ENTITY_VILLAGER_HURT
          - 'SEND_MESSAGE &8[&e&lNPC&8] &aSnorky &e» &7Here are some &bAtoms &7to use toward your upgrade!'
          - PERFORM_COMMAND atoms add %player_name% 10000000
          - SEND_MESSAGE &0
          - WAIT_TICKS 80
          - SEND_SOUND BLOCK_NOTE_BLOCK_PLING
          - 'SEND_TITLE 20 40 20 &a&lNEXT OBJECTIVE,&fUpgrade Your Pickaxe with Fortune 100'
          - SEND_MESSAGE &0
          - SEND_MESSAGE &a&lNEXT OBJECTIVE
          - SEND_MESSAGE &eUpgrade Your Pickaxe with Fortune 100
          - SEND_PARTICLES FIREWORKS_SPARK 3 true
          - SEND_MESSAGE &0

      upgradepickaxe:
        type: PLAYER_ITEMS_REQUIRE
        hide_chat: true
        goto: OBJECT upgradesuccess
        items:
          items:
            a:
              item:
                type: DIAMOND_PICKAXE
                enchantments:
                  LOOT_BONUS_BLOCKS: 100
                flags: HIDE_ENCHANTS
              #name: '&9&m]-&7&m--&8&m--&9 Atomic-Sword &8&m--&7&m--&9&m-['
              check: SameBase
          count: 1
        #error_message: '&cUse &a/upgrade&c to upgrade your &aSword&c to &eSharpness III&c to face the boss!'
        update_notify:
          message: '&7&l&oUpgrade your &a&l&oPickaxe &7&l&owith &e&l&oFortune 100&7&l&o using &b&l&o/upgrade&7&l&o, or type &c&l&oendtutorial&7&l&o to cancel the intro...'
        update_notify_delay: 10 SECOND
        #time_limit:
          #duration: 5 minute
          #fail_goto: BRANCH branch_timed_out

      upgradesuccess:
        type: SERVER_ACTIONS
        hide_chat: true
        goto: OBJECT reach_level_two
        #this is the perm that lets a player teleport up the rock wall
        actions: 
          - SEND_SOUND UI_TOAST_IN
          - SEND_SOUND ENTITY_PLAYER_LEVELUP
          - 'SEND_TITLE 20 40 20 &a&lOBJECTIVE COMPLETE,&bUpgrade your Pickaxe!'
          - SEND_PARTICLES FIREWORKS_SPARK 3 true
          - SEND_MESSAGE &0
          - SEND_SOUND ENTITY_VILLAGER_YES
          - SEND_MESSAGE &6&lOBJECTIVE COMPLETE
          - 'SEND_MESSAGE &bUpgrade Your Pickaxe!'
          - SEND_MESSAGE &0
          - WAIT_TICKS 60
          - SEND_SOUND ENTITY_VILLAGER_HURT
          - 'SEND_MESSAGE &8[&e&lNPC&8] &aSnorky &e» &7Well done &b%player_name%&7! With an upgraded Pickaxe, you''ll climb through the levels at a faster pace.'
          - SEND_MESSAGE &0
          - WAIT_TICKS 80
          - SEND_SOUND ENTITY_VILLAGER_HURT
          - 'SEND_MESSAGE &8[&e&lNPC&8] &aSnorky &e» &7Go ahead now and use that pickaxe to reach &aLevel 2&7.'
          - SEND_MESSAGE &0
          - WAIT_TICKS 80
          - SEND_SOUND BLOCK_NOTE_BLOCK_PLING
          - 'SEND_TITLE 20 40 20 &a&lNEXT OBJECTIVE,&fReach Level 2'
          - SEND_MESSAGE &0
          - SEND_MESSAGE &a&lNEXT OBJECTIVE
          - SEND_MESSAGE &eContinue to Mine and Reach Level 2
          - PERFORM_COMMAND lp user %player_name% permission set jetsprisonmines.blockbreak.lvl.1 true 
          - SEND_PARTICLES FIREWORKS_SPARK 3 true
          - SEND_MESSAGE &0
     
      reach_level_two:
        type: NONE
        progress_conditions:
          conditions:
            a:
              type: LOGIC
              logic: '%xprison_level% >= 2'
        goto: OBJECT leveled_up_again   
        update_notify:
          message: '&b&l&oContinue mining to reach Level 2...'
        update_notify_delay: 10 SECOND  

      leveled_up_again:
        type: SERVER_ACTIONS
        hide_chat: true
        goto: OBJECT purchasemultiplier
        actions: 
          - SEND_SOUND UI_TOAST_IN
          - SEND_SOUND ENTITY_PLAYER_LEVELUP
          - 'SEND_TITLE 20 40 20 &a&lOBJECTIVE COMPLETE,&eReach Level 2'
          - PERFORM_COMMAND lp user %player_name% permission set jetsprisonmines.blockbreak.lvl.1 false 
          - SEND_PARTICLES FIREWORKS_SPARK 3 true
          - SEND_MESSAGE &0
          - SEND_SOUND ENTITY_VILLAGER_YES
          - SEND_MESSAGE &6&lOBJECTIVE COMPLETE
          - SEND_MESSAGE &eReach Level 2
          - SEND_MESSAGE &0
          - WAIT_TICKS 80
          - SEND_SOUND ENTITY_VILLAGER_HURT
          - 'SEND_MESSAGE &8[&e&lNPC&8] &aSnorky &e» &7You''re practically a pro already, &b%player_name%&7!'
          - SEND_MESSAGE &0
          - WAIT_TICKS 80
          - SEND_SOUND ENTITY_VILLAGER_HURT
          - 'SEND_MESSAGE &8[&e&lNPC&8] &aSnorky &e» &7Let''s kick it up a notch before we set you loose on your own in this prison...'
          - SEND_MESSAGE &0
          - WAIT_TICKS 80
          - 'SEND_MESSAGE &8[&e&lNPC&8] &aSnorky &e» &7I''m going to give you some &eTokens&7 so you can purchase a &aProgress Multiplier&7 in the shop.'
          - SEND_MESSAGE &0
          - WAIT_TICKS 80
          - SEND_SOUND ENTITY_VILLAGER_HURT
          - 'SEND_MESSAGE &8[&e&lNPC&8] &aSnorky &e» &7To purchase a multiplier, &7run the &e/tokenshop &7command and select the &a&lMultipliers &7category.'
          - SEND_MESSAGE &0
          - WAIT_TICKS 80
          - SEND_SOUND ENTITY_VILLAGER_HURT
          - 'SEND_MESSAGE &8[&e&lNPC&8] &aSnorky &e» &7From there, purchase the &a+1x Multi for 3m. &7multiplier for &e100,000 Tokens&7 and redeem the voucher to activate it.'
          - SEND_MESSAGE &0
          - WAIT_TICKS 80
          - SEND_SOUND BLOCK_NOTE_BLOCK_PLING
          - 'SEND_TITLE 20 40 20 &a&lNEXT OBJECTIVE,&fPurchase a Progress Multiplier'
          - SEND_MESSAGE &0
          - SEND_MESSAGE &a&lNEXT OBJECTIVE
          - SEND_MESSAGE &ePurchase a &a1x for 3m Progress Multiplier &efrom the Tokenshop
          - PERFORM_COMMAND tm add %player_name% 10000000 -s
          - SEND_PARTICLES FIREWORKS_SPARK 3 true
          - SEND_MESSAGE &0

      purchasemultiplier:
        type: NONE
        progress_conditions:
          conditions:
            a:
              type: LOGIC
              logic: '%multiplier_progress_amount% >= 1'
        goto: OBJECT multipliersecured  
        update_notify:
          message: '&b&l&oPurchase a &a+1x Multi for 3m. &7from the &e/tokenshop &7and redeem the voucher.'
        update_notify_delay: 10 SECOND  
        time_limit:
          duration: 2 minutes
          fail_goto: OBJECT multipliernotsecured

      multipliersecured:
        type: SERVER_ACTIONS
        hide_chat: true
        goto: OBJECT level_up_to_three
        #this is the perm that lets a player teleport up the rock wall
        actions: 
          - SEND_SOUND UI_TOAST_IN
          - SEND_SOUND ENTITY_PLAYER_LEVELUP
          - 'SEND_TITLE 20 40 20 &a&lOBJECTIVE COMPLETE,&bPurchase a Progress Multiplier!'
          - SEND_PARTICLES FIREWORKS_SPARK 3 true
          - SEND_MESSAGE &0
          - SEND_SOUND ENTITY_VILLAGER_YES
          - SEND_MESSAGE &6&lOBJECTIVE COMPLETE
          - SEND_MESSAGE &bPurchase a Progress Multiplier
          - SEND_MESSAGE &0
          - WAIT_TICKS 60
          - SEND_SOUND ENTITY_VILLAGER_HURT
          - 'SEND_MESSAGE &8[&e&lNPC&8] &aSnorky &e» &7Well done &b%player_name%&7! That multiplier will speed up your the rate at which you level up!'
          - SEND_MESSAGE &0
          - WAIT_TICKS 80
          - SEND_SOUND ENTITY_VILLAGER_HURT
          - 'SEND_MESSAGE &8[&e&lNPC&8] &aSnorky &e» &7Go ahead now and use that multiplier to reach &aLevel 3&7.'
          - SEND_MESSAGE &0
          - WAIT_TICKS 80
          - SEND_SOUND BLOCK_NOTE_BLOCK_PLING
          - 'SEND_TITLE 20 40 20 &a&lNEXT OBJECTIVE,&fReach Level 3'
          - SEND_MESSAGE &0
          - SEND_MESSAGE &a&lNEXT OBJECTIVE
          - SEND_MESSAGE &eContinue to Mine and Reach Level 3
          - PERFORM_COMMAND lp user %player_name% permission set jetsprisonmines.blockbreak.lvl.1 true 
          - SEND_PARTICLES FIREWORKS_SPARK 3 true
          - SEND_MESSAGE &0

      level_up_to_three:
        type: NONE
        progress_conditions:
          conditions:
            a:
              type: LOGIC
              logic: '%xprison_level% >= 3'
        goto: OBJECT leveled_up_final   
        update_notify:
          message: '&b&l&oContinue mining to reach Level 3...'
        update_notify_delay: 10 SECOND 

      multipliernotsecured:
        type: SERVER_ACTIONS
        hide_chat: true
        goto: OBJECT level_up_to_three
        #this is the perm that lets a player teleport up the rock wall
        actions: 
          - SEND_SOUND UI_TOAST_IN
          - SEND_SOUND block_amethyst_cluster_break
          - 'SEND_TITLE 20 40 20 &c&lOBJECTIVE FAILED,&bPurchase a Progress Multiplier!'
          - SEND_PARTICLES FIREWORKS_SPARK 3 true
          - SEND_MESSAGE &0
          - SEND_SOUND ENTITY_VILLAGER_YES
          - SEND_MESSAGE &c&lOBJECTIVE FAILED
          - SEND_MESSAGE &bPurchase a Progress Multiplier
          - SEND_MESSAGE &0
          - WAIT_TICKS 60
          - SEND_SOUND ENTITY_VILLAGER_HURT
          - 'SEND_MESSAGE &8[&e&lNPC&8] &aSnorky &e» &7Well &b%player_name%&7, you didn''t quite follow directions there!'
          - SEND_MESSAGE &0
          - WAIT_TICKS 80
          - SEND_SOUND ENTITY_VILLAGER_HURT
          - 'SEND_MESSAGE &8[&e&lNPC&8] &aSnorky &e» &7When browsing the &eTokenshop&7, pay close attention to your options.'
          - SEND_MESSAGE &0
          - WAIT_TICKS 80
          - SEND_SOUND ENTITY_VILLAGER_HURT
          - 'SEND_MESSAGE &8[&e&lNPC&8] &aSnorky &e» &7For now, I''ll set you up with a &a1x for 3m Progress Multiplier&7.'
          - SEND_MESSAGE &0
          - WAIT_TICKS 80
          - SEND_SOUND ENTITY_VILLAGER_HURT
          - 'SEND_MESSAGE &8[&e&lNPC&8] &aSnorky &e» &7Go ahead and proceed with the tutorial...'
          - SEND_MESSAGE &0
          - WAIT_TICKS 80
          - SEND_SOUND BLOCK_NOTE_BLOCK_PLING
          - 'SEND_TITLE 20 40 20 &a&lNEXT OBJECTIVE,&fReach Level 3'
          - SEND_MESSAGE &0
          - SEND_MESSAGE &a&lNEXT OBJECTIVE
          - SEND_MESSAGE &eContinue to Mine and Reach Level 3
          - PERFORM_COMMAND asa setmultiplier %player_name% 1 3
          - PERFORM_COMMAND lp user %player_name% permission set jetsprisonmines.blockbreak.lvl.1 true 
          - SEND_PARTICLES FIREWORKS_SPARK 3 true
          - SEND_MESSAGE &0 

      leveled_up_final:
        type: SERVER_ACTIONS
        hide_chat: true
        goto: OBJECT end_quest
        actions: 
          - SEND_SOUND UI_TOAST_IN
          - SEND_SOUND ENTITY_PLAYER_LEVELUP
          - 'SEND_TITLE 20 40 20 &a&lOBJECTIVE COMPLETE,&eReach Level 3'
          - SEND_PARTICLES FIREWORKS_SPARK 3 true
          - SEND_MESSAGE &0
          - SEND_SOUND ENTITY_VILLAGER_YES
          - SEND_MESSAGE &6&lOBJECTIVE COMPLETE
          - SEND_MESSAGE &eReach Level 3
          - SEND_MESSAGE &0
          - WAIT_TICKS 80
          - SEND_SOUND ENTITY_VILLAGER_HURT
          - 'SEND_MESSAGE &8[&e&lNPC&8] &aSnorky &e» &7You''ve done it, &b%player_name%&7!'
          - SEND_MESSAGE &0
          - WAIT_TICKS 80
          - SEND_SOUND ENTITY_VILLAGER_HURT
          - 'SEND_MESSAGE &8[&e&lNPC&8] &aSnorky &e» &7I think you now have what you need to go ahead and climb the ranks of this Prison.'
          - SEND_MESSAGE &0
          - WAIT_TICKS 80
          - 'SEND_MESSAGE &8[&e&lNPC&8] &aSnorky &e» &7I''m going to return you to the prison now!'
          - SEND_MESSAGE &0
          - WAIT_TICKS 80
          - SEND_SOUND ENTITY_VILLAGER_HURT
          - 'SEND_MESSAGE &8[&e&lNPC&8] &aSnorky &e» &7Continue your grind, &b%player_name%&7...'
          - SEND_MESSAGE &0
          - WAIT_TICKS 80

  
      end_quest:
        type: SERVER_ACTIONS
        hide_chat: false
        goto: QUEST_SUCCESS
        actions: 
          - PERFORM_COMMAND lp user %player_name% parent add default
          - PERFORM_COMMAND lp user %player_name% parent remove prisonintro
          - PERFORM_COMMAND restoreinventory %player_name%
          - WAIT_TICKS 10
          - PERFORM_COMMAND setchannel %player_name% global
          - SEND_SOUND ENTITY_PLAYER_LEVELUP
          - SEND_MESSAGE &0
          - 'SEND_MESSAGE &a&lPRISON INTRO COMPLETE!'
          - SEND_MESSAGE &0
          - PERFORM_COMMAND level set %player_name% {variable:CurrentLevel} false
          - PERFORM_COMMAND warp spawn %player_name%
          - PERFORM_COMMAND atoms set %player_name% {variable:CurrentAtoms}
          - PERFORM_COMMAND tm set %player_name% {variable:CurrentTokens}
          - PERFORM_COMMAND asa setmultiplier %player_name% {variable:CurrentMultiplier} {variable:CurrentMultiplierMinutes}
          - WAIT_TICKS 20
          - PERFORM_COMMAND eco set %player_name% {variable:CurrentProgress}
          - PERFORM_COMMAND lp user %player_name% permission unset progress.milestones 
          - PERFORM_COMMAND lp user %player_name% permission set interactive.prison.complete true
          - PERFORM_COMMAND lp user %player_name% permission unset progress.interactive.rewards 
          - SEND_MESSAGE &0


      select_end_quest:
        type: SERVER_ACTIONS
        hide_chat: false
        goto: QUEST_CANCEL
        #activators: [activator_auto]
        actions: 
          - PERFORM_COMMAND lp user %player_name% parent add default
          - PERFORM_COMMAND lp user %player_name% parent remove prisonintro
          - PERFORM_COMMAND restoreinventory %player_name%
          - WAIT_TICKS 10
          - PERFORM_COMMAND setchannel %player_name% global
          - SEND_SOUND ENTITY_PLAYER_LEVELUP
          - SEND_MESSAGE &0
          - 'SEND_MESSAGE &c&lSERVER INTRO CANCELLED'
          - SEND_MESSAGE &0
          - PERFORM_COMMAND level set %player_name% {variable:CurrentLevel} false
          - PERFORM_COMMAND warp spawn %player_name%
          - PERFORM_COMMAND atoms set %player_name% {variable:CurrentAtoms}
          - PERFORM_COMMAND tm set %player_name% {variable:CurrentTokens}
          - PERFORM_COMMAND asa setmultiplier %player_name% {variable:CurrentMultiplier} {variable:CurrentMultiplierMinutes}
          - WAIT_TICKS 20
          - PERFORM_COMMAND eco set %player_name% {variable:CurrentProgress}
          - PERFORM_COMMAND lp user %player_name% permission unset progress.milestones 
          - PERFORM_COMMAND lp user %player_name% permission unset progress.interactive.rewards 
          - SEND_MESSAGE &0

  branch_timed_out:
    starts_at: time_out_delay #dialogue_1
    starts_directly: false
    objects:

      time_out_delay:
        type: SERVER_ACTIONS
        hide_chat: true
        goto: OBJECT timed_out
        actions: 
          - WAIT_TICKS 100

      timed_out:
        type: SERVER_ACTIONS
        hide_chat: false
        goto: QUEST_CANCEL
        actions: 
          - PERFORM_COMMAND lp user %player_name% parent add default
          - PERFORM_COMMAND lp user %player_name% parent remove prisonintro
          - PERFORM_COMMAND restoreinventory %player_name%
          - WAIT_TICKS 10
          - PERFORM_COMMAND setchannel %player_name% global
          - SEND_SOUND ENTITY_PLAYER_LEVELUP
          - SEND_MESSAGE &0
          - 'SEND_MESSAGE &c&lSERVER INTRO CANCELLED'
          - SEND_MESSAGE &0
          - PERFORM_COMMAND level set %player_name% {variable:CurrentLevel} false
          - PERFORM_COMMAND warp spawn %player_name%
          - PERFORM_COMMAND atoms set %player_name% {variable:CurrentAtoms}
          - PERFORM_COMMAND tm set %player_name% {variable:CurrentTokens}
          - PERFORM_COMMAND asa setmultiplier %player_name% {variable:CurrentMultiplier} {variable:CurrentMultiplierMinutes}
          - WAIT_TICKS 20
          - PERFORM_COMMAND eco set %player_name% {variable:CurrentProgress}
          - PERFORM_COMMAND lp user %player_name% permission unset progress.milestones 
          - PERFORM_COMMAND lp user %player_name% permission unset progress.interactive.rewards 
          - SEND_MESSAGE &0

  cancel:
    display_name: cancel
    starts_at: cancel
    objects:

      cancel:
        hide_chat: true
        type: PLAYER_CHAT
        whitelist: [endtutorial, /endtutorial]
        goto: OBJECT end_quest_end
        update_notify:
          message: | 
            &r
            &8&l(&c&l!&8&l) &cYou are currently in the Interactive Prison Tutorial. 
            &eCertain features and commands will not work while this is active. 
            &cType &e/endtutorial&c to exit the tutorial and return normal function.
            &r
        update_notify_delay: 30 SECOND

      end_quest_end:
        type: SERVER_ACTIONS
        hide_chat: false
        goto: QUEST_CANCEL
        #activators: [activator_auto]
        actions: 
          - PERFORM_COMMAND lp user %player_name% parent add default
          - PERFORM_COMMAND lp user %player_name% parent remove prisonintro
          - PERFORM_COMMAND restoreinventory %player_name%
          - WAIT_TICKS 10
          - PERFORM_COMMAND setchannel %player_name% global
          - SEND_SOUND ENTITY_PLAYER_LEVELUP
          - SEND_MESSAGE &0
          - 'SEND_MESSAGE &c&lSERVER INTRO CANCELLED'
          - SEND_MESSAGE &0
          - PERFORM_COMMAND level set %player_name% {variable:CurrentLevel} false
          - PERFORM_COMMAND warp spawn %player_name%
          - PERFORM_COMMAND atoms set %player_name% {variable:CurrentAtoms}
          - PERFORM_COMMAND tm set %player_name% {variable:CurrentTokens}
          - PERFORM_COMMAND asa setmultiplier %player_name% {variable:CurrentMultiplier} {variable:CurrentMultiplierMinutes}
          - WAIT_TICKS 20
          - PERFORM_COMMAND eco set %player_name% {variable:CurrentProgress}
          - PERFORM_COMMAND lp user %player_name% permission unset progress.milestones 
          - PERFORM_COMMAND lp user %player_name% permission unset progress.interactive.rewards 
          - SEND_MESSAGE &0


progress_notify_scoreboard: false